{% extends "base.html" %}
{% block content %}
<h3 class="mb-4">Todos los eventos disponibles</h3>

<!-- FILTROS PARA USUARIOS NORMALES -->
<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title">
      <i class="fas fa-filter me-2"></i>Filtrar Eventos
    </h5>
    <form method="get" class="row g-3">
      <input type="hidden" name="page" value="1">
      
      <div class="col-md-4">
        <label class="form-label">Nombre</label>
        <input type="text" class="form-control" name="nombre" 
               value="{{ filtros.nombre }}" placeholder="Buscar por nombre...">
      </div>
      <div class="col-md-3">
        <label class="form-label">Tipo</label>
        <select class="form-select" name="tipo">
          <option value="">Todos</option>
          {% for tipo in ['foro','debate','taller','simposio','panel de expertos','seminario','conferencia'] %}
          <option value="{{ tipo }}" {% if filtros.tipo == tipo %}selected{% endif %}>
            {{ tipo|capitalize }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Modalidad</label>
        <select class="form-select" name="modalidad">
          <option value="">Todas</option>
          <option value="presencial" {% if filtros.modalidad == 'presencial' %}selected{% endif %}>Presencial</option>
          <option value="virtual" {% if filtros.modalidad == 'virtual' %}selected{% endif %}>Virtual</option>
        </select>
      </div>
      <div class="col-md-2 align-self-end">
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">Filtrar</button>
          <a href="{{ url_for('eventos.eventos_list') }}" class="btn btn-outline-secondary">Limpiar</a>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="row g-4">
    {% for e in eventos %}
    <div class="col-md-6 col-xl-4">
        <div class="card h-100 shadow-sm">
            <img class="card-img-top" src="{{ e.tipo_evento|imagen_evento }}" alt="{{e.tipo_evento}}">
        <div class="card-body d-flex flex-column">
        <span class="badge text-bg-secondary mb-2">{{ e.tipo_evento|capitalize }}</span>
        <span class="badge {% if e.modalidad == 'virtual' %}text-bg-secondary{% else %}text-bg-dark{% endif %} mb-2">
            {{ 'Virtual' if e.modalidad == 'virtual' else 'Presencial' }}
        </span>
        <h5 class="card-title">{{ e.nombre }}</h5>
        <p class="small text-muted mb-1">
            {{ e.fecha_inicio|fecha_larga }}{% if e.fecha_fin %} – {{ e.fecha_fin|fecha_larga }}{% endif %}
        </p>
        <p class="small text-muted">{{ e.ciudad or e.lugar or 'Sin ubicación' }}</p>
        <div class="mt-auto d-flex gap-2 flex-wrap">
            <a class="btn btn-light" href="{{ url_for('eventos.evento_detalle', eid=e.id_evento) }}">Más info</a>
            <form method="post" action="{{ url_for('eventos.inscribirme', eid=e.id_evento) }}">
            <button class="btn btn-primary" {% if e.id_evento in inscritas %}disabled{% endif %}>
                {% if e.id_evento in inscritas %}Inscrito{% else %}Inscribirme{% endif %}
            </button>
            </form>
        </div>
        </div>
    </div>
    </div>
    {% else %}
    <div class="col-12">
    <div class="alert alert-light border">No hay eventos disponibles.</div>
    </div>
    {% endfor %}
</div>

<!-- PAGINACIÓN PARA USUARIOS NORMALES -->
{% if pagination.pages > 1 %}
<nav aria-label="Paginación de eventos" class="mt-4">
  <ul class="pagination justify-content-center">
    {% if pagination.page > 1 %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('eventos.eventos_list', page=pagination.page-1, **filtros) }}">Anterior</a>
    </li>
    {% endif %}
    
    {% for p in range(1, pagination.pages + 1) %}
    <li class="page-item {% if p == pagination.page %}active{% endif %}">
      <a class="page-link" href="{{ url_for('eventos.eventos_list', page=p, **filtros) }}">{{ p }}</a>
    </li>
    {% endfor %}
    
    {% if pagination.page < pagination.pages %}
    <li class="page-item">
      <a class="page-link" href="{{ url_for('eventos.eventos_list', page=pagination.page+1, **filtros) }}">Siguiente</a>
    </li>
    {% endif %}
  </ul>
</nav>

<div class="text-center text-muted mt-2">
  Mostrando {{ eventos|length }} de {{ pagination.total }} eventos
  (Página {{ pagination.page }} de {{ pagination.pages }})
</div>
{% endif %}
{% endblock %}